{% extends 'base.html' %}

{% block title %}Cita de {{ patient.full_name }} - MakiMotion{% endblock %}

{% block content %}
<div class="appointment-detail-container">
    <div class="appointment-header">
        <div class="appointment-info">
            <h2>Cita de {{ patient.full_name }}</h2>
            <div class="appointment-meta">
                <span class="appointment-date">{{ appointment.date_time|date:"d/m/Y H:i" }}</span>
                <span class="perfect-summary">Test PERFECT completado</span>
            </div>
        </div>
        <div class="appointment-actions">
            <a href="{% url 'appointment_update' appointment.pk %}" class="btn btn-primary">Editar Cita</a>
            <a href="{% url 'appointment_delete' appointment.pk %}" class="btn btn-danger">Eliminar Cita</a>
            <a href="{% url 'patient_detail' patient.pk %}" class="btn btn-secondary">Volver al Paciente</a>
        </div>
    </div>
    
    <div class="appointment-content">
        <div class="appointment-details-section">
            <div class="card">
                <h3>Detalles de la Cita</h3>
                <div class="detail-item">
                    <strong>Paciente:</strong>
                    <span>{{ patient.full_name }}</span>
                </div>
                <div class="detail-item">
                    <strong>Fecha y Hora:</strong>
                    <span>{{ appointment.date_time|date:"d/m/Y H:i" }}</span>
                </div>

                <div class="detail-item">
                    <strong>Creado:</strong>
                    <span>{{ appointment.created_at|date:"d/m/Y H:i" }}</span>
                </div>
                {% if appointment.updated_at != appointment.created_at %}
                    <div class="detail-item">
                        <strong>Última Actualización:</strong>
                        <span>{{ appointment.updated_at|date:"d/m/Y H:i" }}</span>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="appointment-description-section">
            <div class="card">
                <h3>Descripción de la Sesión</h3>
                <div class="session-content">
                    <p>{{ appointment.session_description|linebreaks }}</p>
                </div>
            </div>
            
            <!-- Test PERFECT Results -->
            <div class="card">
                <h3>🎯 Resultados Test PERFECT</h3>
                <div class="perfect-results">
                    <div class="perfect-scores-grid">
                        <div class="perfect-score-item">
                            <span class="score-label">P - Power (Fuerza)</span>
                            <span class="score-value">{{ appointment.perfect_p_power|default:"No evaluado" }}</span>
                        </div>
                        <div class="perfect-score-item">
                            <span class="score-label">E - Endurance (Resistencia)</span>
                            <span class="score-value">{{ appointment.perfect_e_endurance|default:"No evaluado" }}</span>
                        </div>
                        <div class="perfect-score-item">
                            <span class="score-label">R - Repetitions (Repeticiones)</span>
                            <span class="score-value">{{ appointment.perfect_r_repetitions|default:"No evaluado" }}</span>
                        </div>
                        <div class="perfect-score-item">
                            <span class="score-label">F - Fast contractions (Contracciones rápidas)</span>
                            <span class="score-value">{{ appointment.perfect_f_fast|default:"No evaluado" }}</span>
                        </div>
                        <div class="perfect-score-item">
                            <span class="score-label">E - Elevación</span>
                            <span class="score-value">
                                {% if appointment.perfect_e_every %}
                                    {{ appointment.get_perfect_e_every_display }}
                                {% else %}
                                    No evaluado
                                {% endif %}
                            </span>
                        </div>
                        <div class="perfect-score-item">
                            <span class="score-label">C - Co-contraction (Co-contracción)</span>
                            <span class="score-value">
                                {% if appointment.perfect_c_cocontraction %}
                                    {{ appointment.get_perfect_c_cocontraction_display }}
                                {% else %}
                                    No evaluado
                                {% endif %}
                            </span>
                        </div>
                        <div class="perfect-score-item">
                            <span class="score-label">T - Timing (Coordinación)</span>
                            <span class="score-value">
                                {% if appointment.perfect_t_timing %}
                                    {{ appointment.get_perfect_t_timing_display }}
                                {% else %}
                                    No evaluado
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            {% if appointment.additional_notes %}
                <div class="card">
                    <h3>Notas Adicionales</h3>
                    <div class="notes-content">
                        <p>{{ appointment.additional_notes|linebreaks }}</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
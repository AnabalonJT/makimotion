{% extends 'base.html' %}

{% block title %}{{ title }} - {{ patient.full_name }} - MakiMotion{% endblock %}

{% block content %}
<div class="clinical-form-container">
    <div class="form-header">
        <h2>{{ title }}: {{ patient.full_name }}</h2>
        <p class="form-subtitle">
            {% if ficha %}
                Actualiza la información de la ficha clínica
            {% else %}
                Completa los datos de la nueva ficha clínica
            {% endif %}
        </p>
    </div>
    
    {% if form.errors %}
        <div class="alert alert-error">
            <strong>Por favor corrige los siguientes errores:</strong>
            <ul>
                {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>
        </div>
    {% endif %}
    
    <form method="post" class="clinical-form" id="ficha-clinica-form">
        {% csrf_token %}
        
        <!-- SECCIÓN 1: MOTIVO DE CONSULTA -->
        <div class="form-section">
            <h3 class="section-title">📋 Motivo de Consulta</h3>
            <div class="section-content">
                <div class="form-group">
                    <label for="{{ form.consultation_reason.id_for_label }}">Motivo de Consulta *</label>
                    {{ form.consultation_reason }}
                    {% if form.consultation_reason.errors %}<span class="field-error">{{ form.consultation_reason.errors.0 }}</span>{% endif %}
                </div>
            </div>
        </div>

        <!-- SECCIÓN 2: APRENDIZAJES GENERALES -->
        <div class="form-section">
            <h3 class="section-title">🧠 Aprendizajes Generales</h3>
            <div class="section-content">
                <div class="checkbox-grid">
                    <div class="checkbox-item">
                        {{ form.aprendizaje_pujo_caca }}
                        <label for="{{ form.aprendizaje_pujo_caca.id_for_label }}">Pujo caca</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_banquito }}
                        <label for="{{ form.aprendizaje_banquito.id_for_label }}">Uso de banquito</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_transverso }}
                        <label for="{{ form.aprendizaje_transverso.id_for_label }}">Activación transverso abdominal</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_respiracion_pelvico }}
                        <label for="{{ form.aprendizaje_respiracion_pelvico.id_for_label }}">Respiración + contracción piso pélvico</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_contraccion_pelvico }}
                        <label for="{{ form.aprendizaje_contraccion_pelvico.id_for_label }}">Contracción piso pélvico</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_preapretar }}
                        <label for="{{ form.aprendizaje_preapretar.id_for_label }}">Preapretar</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="{{ form.aprendizaje_otros.id_for_label }}">Otros Aprendizajes Generales</label>
                    {{ form.aprendizaje_otros }}
                    {% if form.aprendizaje_otros.errors %}<span class="field-error">{{ form.aprendizaje_otros.errors.0 }}</span>{% endif %}
                </div>
            </div>
        </div>

        <!-- SECCIÓN 3: APRENDIZAJES EMBARAZO -->
        <div class="form-section">
            <h3 class="section-title">🤰 Aprendizajes Embarazo</h3>
            <div class="section-content">
                <div class="checkbox-grid">
                    <div class="checkbox-item">
                        {{ form.aprendizaje_emb_oms }}
                        <label for="{{ form.aprendizaje_emb_oms.id_for_label }}">OMS</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_emb_anatomia }}
                        <label for="{{ form.aprendizaje_emb_anatomia.id_for_label }}">Anatomía</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_emb_movimientos }}
                        <label for="{{ form.aprendizaje_emb_movimientos.id_for_label }}">Movimientos cardinales</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_emb_posicion_trabajo }}
                        <label for="{{ form.aprendizaje_emb_posicion_trabajo.id_for_label }}">Posición trabajo de parto</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_emb_posicion_expulsion }}
                        <label for="{{ form.aprendizaje_emb_posicion_expulsion.id_for_label }}">Posición expulsión</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_emb_intervencion }}
                        <label for="{{ form.aprendizaje_emb_intervencion.id_for_label }}">Intervención obstétrica</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_emb_masaje_perineal }}
                        <label for="{{ form.aprendizaje_emb_masaje_perineal.id_for_label }}">Masaje perineal</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_emb_respiraciones }}
                        <label for="{{ form.aprendizaje_emb_respiraciones.id_for_label }}">Respiraciones</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_emb_pujo }}
                        <label for="{{ form.aprendizaje_emb_pujo.id_for_label }}">Pujo embarazo</label>
                    </div>
                    <div class="checkbox-item">
                        {{ form.aprendizaje_emb_tecnicas_dolor }}
                        <label for="{{ form.aprendizaje_emb_tecnicas_dolor.id_for_label }}">Técnicas de dolor</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="{{ form.aprendizaje_emb_otros.id_for_label }}">Otros Aprendizajes Embarazo</label>
                    {{ form.aprendizaje_emb_otros }}
                    {% if form.aprendizaje_emb_otros.errors %}<span class="field-error">{{ form.aprendizaje_emb_otros.errors.0 }}</span>{% endif %}
                </div>
            </div>
        </div>

        <!-- SECCIÓN 4: HÁBITOS DE VIDA -->
        <div class="form-section">
            <h3 class="section-title">🏃 Hábitos de Vida</h3>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.smoking.id_for_label }}">¿Fuma?</label>
                        {{ form.smoking }}
                        {% if form.smoking.errors %}<span class="field-error">{{ form.smoking.errors.0 }}</span>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.alcohol.id_for_label }}">¿Consume alcohol?</label>
                        {{ form.alcohol }}
                        {% if form.alcohol.errors %}<span class="field-error">{{ form.alcohol.errors.0 }}</span>{% endif %}
                    </div>
                </div>
                <div class="form-group">
                    <label for="{{ form.physical_activity.id_for_label }}">Actividad Física</label>
                    {{ form.physical_activity }}
                    {% if form.physical_activity.errors %}<span class="field-error">{{ form.physical_activity.errors.0 }}</span>{% endif %}
                </div>
                <div class="form-group">
                    <label for="{{ form.diet.id_for_label }}">Dieta</label>
                    {{ form.diet }}
                    {% if form.diet.errors %}<span class="field-error">{{ form.diet.errors.0 }}</span>{% endif %}
                </div>
                <div class="form-group">
                    <label for="{{ form.daily_liquid_consumption.id_for_label }}">Consumo Líquido Diario</label>
                    {{ form.daily_liquid_consumption }}
                    {% if form.daily_liquid_consumption.errors %}<span class="field-error">{{ form.daily_liquid_consumption.errors.0 }}</span>{% endif %}
                </div>
                <div class="form-group">
                    <label for="{{ form.lifestyle_other.id_for_label }}">Otros</label>
                    {{ form.lifestyle_other }}
                    {% if form.lifestyle_other.errors %}<span class="field-error">{{ form.lifestyle_other.errors.0 }}</span>{% endif %}
                </div>
            </div>
        </div>

        <!-- Continue with more sections if needed... -->
         <!-- SECCIÓN 4: FUNCIÓN URINARIA -->
        <div class="form-section">
            <h3 class="section-title">💧 Función Urinaria</h3>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.daily_frequency.id_for_label }}">Frecuencia Diaria</label>
                        {{ form.daily_frequency }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.nocturnal_frequency.id_for_label }}">Frecuencia Nocturna</label>
                        {{ form.nocturnal_frequency }}
                    </div>
                </div>
                
                <!-- Checkboxes función urinaria -->
                <div class="checkbox-group">
                    <h4>Síntomas Urinarios</h4>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">{{ form.pollakiuria }} <label for="{{ form.pollakiuria.id_for_label }}">Polaquiuria</label></div>
                        <div class="checkbox-item">{{ form.nocturia }} <label for="{{ form.nocturia.id_for_label }}">Nocturia</label></div>
                        <div class="checkbox-item">{{ form.urgency }} <label for="{{ form.urgency.id_for_label }}">Urgencia</label></div>
                        <div class="checkbox-item">{{ form.polyuria }} <label for="{{ form.polyuria.id_for_label }}">Poliuria</label></div>
                        <div class="checkbox-item">{{ form.dysuria }} <label for="{{ form.dysuria.id_for_label }}">Disuria</label></div>
                        <div class="checkbox-item">{{ form.latency }} <label for="{{ form.latency.id_for_label }}">Latencia</label></div>
                        <div class="checkbox-item">{{ form.effort_to_urinate }} <label for="{{ form.effort_to_urinate.id_for_label }}">Esfuerzo para Orinar</label></div>
                        <div class="checkbox-item">{{ form.incomplete_emptying }} <label for="{{ form.incomplete_emptying.id_for_label }}">Vaciamiento Incompleto</label></div>
                        <div class="checkbox-item">{{ form.immediate_need }} <label for="{{ form.immediate_need.id_for_label }}">Necesidad Inmediata</label></div>
                        <div class="checkbox-item">{{ form.terminal_dripping }} <label for="{{ form.terminal_dripping.id_for_label }}">Goteo Terminal</label></div>
                        <div class="checkbox-item">{{ form.nocturnal_urgency }} <label for="{{ form.nocturnal_urgency.id_for_label }}">Urgencia Nocturna</label></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.urination_position.id_for_label }}">Posición Adoptada para Micción</label>
                        {{ form.urination_position }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.stream_description.id_for_label }}">Descripción del Chorro</label>
                        {{ form.stream_description }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.urinary_function_other.id_for_label }}">Otros</label>
                    {{ form.urinary_function_other }}
                </div>
            </div>
        </div>

        <!-- SUBSECCIÓN: INCONTINENCIA ORINA -->
        <div class="form-section subsection">
            <h3 class="section-title">💦 Incontinencia Orina</h3>
            <div class="section-content">
                <!-- Checkboxes incontinencia -->
                <div class="checkbox-group">
                    <h4>Tipos de Incontinencia</h4>
                    <div class="checkbox-row">
                        <div class="checkbox-item">{{ form.iue }} <label for="{{ form.iue.id_for_label }}">IUE</label></div>
                        <div class="checkbox-item">{{ form.iuu }} <label for="{{ form.iuu.id_for_label }}">IUU</label></div>
                        <div class="checkbox-item">{{ form.ium }} <label for="{{ form.ium.id_for_label }}">IUM</label></div>
                        <div class="checkbox-item">{{ form.iu_posture }} <label for="{{ form.iu_posture.id_for_label }}">IU Postura</label></div>
                        <div class="checkbox-item">{{ form.iu_sensitivity }} <label for="{{ form.iu_sensitivity.id_for_label }}">IU Sensibilidad</label></div>
                        <div class="checkbox-item">{{ form.iu_coital }} <label for="{{ form.iu_coital.id_for_label }}">IU Coital</label></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.incontinence_other.id_for_label }}">Otros</label>
                        {{ form.incontinence_other }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.since_when.id_for_label }}">Hace Cuánto</label>
                        {{ form.since_when }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.when_occurs_daily.id_for_label }}">Cuándo Ocurre por Día</label>
                        {{ form.when_occurs_daily }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.how_daily.id_for_label }}">Cómo es por Día</label>
                        {{ form.how_daily }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.protection_type.id_for_label }}">Tipo de Protección</label>
                        {{ form.protection_type }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.activities_stopped.id_for_label }}">Actividades Dejadas</label>
                        {{ form.activities_stopped }}
                    </div>
                </div>
            </div>
        </div>

        <!-- SECCIÓN 5: FUNCIONAMIENTO INTESTINAL -->
        <div class="form-section">
            <h3 class="section-title">🦴 Funcionamiento Intestinal</h3>
            <div class="section-content">
                <!-- Checkboxes intestinales -->
                <div class="checkbox-group">
                    <h4>Síntomas Intestinales</h4>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">{{ form.constipation }} <label for="{{ form.constipation.id_for_label }}">Estreñimiento</label></div>
                        <div class="checkbox-item">{{ form.fecal_incontinence }} <label for="{{ form.fecal_incontinence.id_for_label }}">Incontinencia</label></div>
                        <div class="checkbox-item">{{ form.gas_incontinence }} <label for="{{ form.gas_incontinence.id_for_label }}">Incontinencia Gases</label></div>
                        <div class="checkbox-item">{{ form.hemorrhoids }} <label for="{{ form.hemorrhoids.id_for_label }}">Hemorroides</label></div>
                        <div class="checkbox-item">{{ form.rectocele }} <label for="{{ form.rectocele.id_for_label }}">Rectocele</label></div>
                        <div class="checkbox-item">{{ form.gas_stool_discrimination }} <label for="{{ form.gas_stool_discrimination.id_for_label }}">Discriminación Gas/Caca</label></div>
                        <div class="checkbox-item">{{ form.painful_evacuation }} <label for="{{ form.painful_evacuation.id_for_label }}">Evacuación Dolorosa</label></div>
                        <div class="checkbox-item">{{ form.straining_defecation }} <label for="{{ form.straining_defecation.id_for_label }}">Puja para Defecar</label></div>
                        <div class="checkbox-item">{{ form.complete_evacuation }} <label for="{{ form.complete_evacuation.id_for_label }}">Evacuación Completa</label></div>
                        <div class="checkbox-item">{{ form.laxatives }} <label for="{{ form.laxatives.id_for_label }}">Laxantes</label></div>
                        <div class="checkbox-item">{{ form.plugging_sensation }} <label for="{{ form.plugging_sensation.id_for_label }}">Sensación de Tapón</label></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.defecation_position.id_for_label }}">Posición para Defecar</label>
                        {{ form.defecation_position }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.bristol_scale.id_for_label }}">Escala Bristol (1-7)</label>
                        {{ form.bristol_scale }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.position_frequency.id_for_label }}">Frecuencia Deposiciones</label>
                    {{ form.position_frequency }}
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.bowel_inconsistency.id_for_label }}">¿Sufre Inconsistencia? ¿Cuándo?</label>
                        {{ form.bowel_inconsistency }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.bowel_conscious.id_for_label }}">¿Es Consciente?</label>
                        {{ form.bowel_conscious }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.bowel_pad.id_for_label }}">¿Apósito?</label>
                        {{ form.bowel_pad }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.bowel_activities_stopped.id_for_label }}">Actividades Dejadas</label>
                        {{ form.bowel_activities_stopped }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.bowel_function_other.id_for_label }}">Otros</label>
                    {{ form.bowel_function_other }}
                </div>
            </div>
        </div>

        <!-- SECCIÓN 6: HISTORIAL SEXUAL -->
        <div class="form-section">
            <h3 class="section-title">💕 Historial Sexual</h3>
            <div class="section-content">
                <div class="form-group">
                    <label for="{{ form.sexual_status.id_for_label }}">Estado Sexual</label>
                    {{ form.sexual_status }}
                </div>
                
                <div class="checkbox-group">
                    <h4>Incontinencia Durante Actividad Sexual</h4>
                    <div class="checkbox-row">
                        <div class="checkbox-item">
                            {{ form.urinary_incontinence_sexual }} <label for="{{ form.urinary_incontinence_sexual.id_for_label }}">Incontinencia Orina</label>
                        </div>
                        <div class="checkbox-item">
                            {{ form.fecal_incontinence_sexual }} <label for="{{ form.fecal_incontinence_sexual.id_for_label }}">Incontinencia Fecal</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.urinary_incontinence_sexual_when.id_for_label }}">Incontinencia Orina - ¿Cuándo?</label>
                        {{ form.urinary_incontinence_sexual_when }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.fecal_incontinence_sexual_when.id_for_label }}">Incontinencia Fecal - ¿Cuándo?</label>
                        {{ form.fecal_incontinence_sexual_when }}
                    </div>
                </div>
                
                <div class="checkbox-group">
                    <h4>Síntomas Sexuales</h4>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">{{ form.sexual_desire }} <label for="{{ form.sexual_desire.id_for_label }}">Deseo Sexual</label></div>
                        <div class="checkbox-item">{{ form.sexual_excitement }} <label for="{{ form.sexual_excitement.id_for_label }}">Excitación</label></div>
                        <div class="checkbox-item">{{ form.orgasm }} <label for="{{ form.orgasm.id_for_label }}">Orgasmo</label></div>
                        <div class="checkbox-item">{{ form.dyspareunia }} <label for="{{ form.dyspareunia.id_for_label }}">Dispareunia</label></div>
                        <div class="checkbox-item">{{ form.urge_to_urinate_during_sex }} <label for="{{ form.urge_to_urinate_during_sex.id_for_label }}">Deseo de Orinar Durante</label></div>
                        <div class="checkbox-item">{{ form.vaginal_dryness }} <label for="{{ form.vaginal_dryness.id_for_label }}">Resequedad</label></div>
                        <div class="checkbox-item">{{ form.impaired_by_incontinence }} <label for="{{ form.impaired_by_incontinence.id_for_label }}">Perjudicado por Incontinencia</label></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.sexual_history_other.id_for_label }}">Otros</label>
                    {{ form.sexual_history_other }}
                </div>
            </div>
        </div>

        <!-- SECCIÓN 7: EXAMEN FÍSICO -->
        <div class="form-section">
            <h3 class="section-title">🔍 Examen Físico</h3>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.diastasis.id_for_label }}">Diastasis</label>
                        {{ form.diastasis }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.scars.id_for_label }}">Cicatrices</label>
                        {{ form.scars }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.adherences.id_for_label }}">Adherencias</label>
                        {{ form.adherences }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.skin_coloration.id_for_label }}">Coloración de la Piel</label>
                        {{ form.skin_coloration }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.push_exam.id_for_label }}">Pujo</label>
                    {{ form.push_exam }}
                </div>
                
                <!-- NCP - Tono -->
                <div class="subsection-group">
                    <h4>NCP - Tono</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.ncp_tone_contraction.id_for_label }}">Contracción</label>
                            {{ form.ncp_tone_contraction }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.ncp_tone_relaxation.id_for_label }}">Relajación</label>
                            {{ form.ncp_tone_relaxation }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.ncp_tone_push.id_for_label }}">Pujo</label>
                            {{ form.ncp_tone_push }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.ncp_tone_pain.id_for_label }}">Dolor</label>
                            {{ form.ncp_tone_pain }}
                        </div>
                    </div>
                </div>
                
                <!-- Sensibilidad y reflejo -->
                <div class="subsection-group">
                    <h4>Sensibilidad y Reflejo (Dermatoma S2-S4)</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.anal_cutaneous_reflex.id_for_label }}">Reflejo Cutáneo Anal</label>
                            {{ form.anal_cutaneous_reflex }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.vulvo_cavernous_reflex.id_for_label }}">Reflejo Vulvo Cavernoso</label>
                            {{ form.vulvo_cavernous_reflex }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.cough_reflex.id_for_label }}">Reflejo Tusígeno</label>
                            {{ form.cough_reflex }}
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.physical_exam_other.id_for_label }}">Otros</label>
                    {{ form.physical_exam_other }}
                </div>
            </div>
        </div>

        <!-- SECCIÓN 8: EXAMEN INTRACAVITARIO -->
        <div class="form-section">
            <h3 class="section-title">🔬 Examen Intracavitario</h3>
            <div class="section-content">
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        {{ form.intracavitary_consent }} <label for="{{ form.intracavitary_consent.id_for_label }}">Consentimiento</label>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.intracavitary_scars.id_for_label }}">Cicatrices</label>
                        {{ form.intracavitary_scars }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.intracavitary_mucosa.id_for_label }}">Mucosa</label>
                        {{ form.intracavitary_mucosa }}
                    </div>
                </div>
                
                <!-- MEA -->
                <div class="subsection-group">
                    <h4>MEA (Músculos del Elevador del Ano)</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.mea_tonicity_rest.id_for_label }}">Tonicidad MEA Reposo</label>
                            {{ form.mea_tonicity_rest }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.mea_perception.id_for_label }}">Percepción MEA</label>
                            {{ form.mea_perception }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.mea_contraction.id_for_label }}">Contracción MEA</label>
                            {{ form.mea_contraction }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.mea_voluntary_relaxation.id_for_label }}">Relajación Voluntaria MEA</label>
                            {{ form.mea_voluntary_relaxation }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.mea_symmetry_rest.id_for_label }}">Simetría MEA Reposo</label>
                            {{ form.mea_symmetry_rest }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.mea_symmetry_contraction.id_for_label }}">Simetría MEA Contracción</label>
                            {{ form.mea_symmetry_contraction }}
                        </div>
                    </div>
                </div>
                
                <!-- Dolor MEA -->
                <div class="subsection-group">
                    <h4>Dolor MEA</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.mea_pain_eva.id_for_label }}">EVA (0-10)</label>
                            {{ form.mea_pain_eva }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.mea_pain_location.id_for_label }}">Dónde</label>
                            {{ form.mea_pain_location }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.mea_pain_when.id_for_label }}">Cuándo</label>
                            {{ form.mea_pain_when }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.mea_pain_description.id_for_label }}">Descripción</label>
                            {{ form.mea_pain_description }}
                        </div>
                    </div>
                </div>
                
                <!-- Otros exámenes -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.urethral_movement.id_for_label }}">Movimiento Uretral</label>
                        {{ form.urethral_movement }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.transverse_abdominal_tone.id_for_label }}">Tono del Transverso Abdominal</label>
                        {{ form.transverse_abdominal_tone }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.oxford_force.id_for_label }}">Fuerza (Oxford)</label>
                        {{ form.oxford_force }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.superficial_musculature.id_for_label }}">Musculatura Superficial</label>
                        {{ form.superficial_musculature }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.deep_musculature.id_for_label }}">Musculatura Profunda</label>
                    {{ form.deep_musculature }}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.intracavitary_exam_other.id_for_label }}">Otros</label>
                    {{ form.intracavitary_exam_other }}
                </div>
            </div>
        </div>

        <!-- SECCIÓN 9: EXAMEN COLOPROCTOLÓGICO -->
        <div class="form-section">
            <h3 class="section-title">🩻 Examen Coloproctológico</h3>
            <div class="section-content">
                <div class="checkbox-group">
                    <h4>Consentimiento y Observaciones</h4>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">{{ form.coloproctologic_consent }} <label for="{{ form.coloproctologic_consent.id_for_label }}">Consentimiento</label></div>
                        <div class="checkbox-item">{{ form.anal_canal_closure }} <label for="{{ form.anal_canal_closure.id_for_label }}">Cierre Canal Anal</label></div>
                        <div class="checkbox-item">{{ form.irritation }} <label for="{{ form.irritation.id_for_label }}">Irritación</label></div>
                        <div class="checkbox-item">{{ form.stool_remains }} <label for="{{ form.stool_remains.id_for_label }}">Resto de Deposiciones</label></div>
                        <div class="checkbox-item">{{ form.rectocele_exam }} <label for="{{ form.rectocele_exam.id_for_label }}">Recto Cele</label></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.coloproctologic_scars.id_for_label }}">Cicatriz - ¿Dónde?</label>
                        {{ form.coloproctologic_scars }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.coloproctologic_hemorrhoids.id_for_label }}">Hemorroides - ¿Dónde?</label>
                        {{ form.coloproctologic_hemorrhoids }}
                    </div>
                </div>
                
                <!-- Tono y resistencia -->
                <div class="subsection-group">
                    <h4>Tono y Resistencia</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.rest_tone.id_for_label }}">Tono en Reposo</label>
                            {{ form.rest_tone }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.resistance.id_for_label }}">Resistencia</label>
                            {{ form.resistance }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.eae_tonicity_rest.id_for_label }}">Tonicidad EAE Reposo</label>
                            {{ form.eae_tonicity_rest }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.eae_contraction.id_for_label }}">Contracción EAE</label>
                            {{ form.eae_contraction }}
                        </div>
                    </div>
                </div>
                
                <!-- Oxford -->
                <div class="subsection-group">
                    <h4>Oxford</h4>
                    <div class="form-group">
                        <label for="{{ form.oxford_notes.id_for_label }}">Oxford</label>
                        {{ form.oxford_notes }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.oxford_anorectal_angle.id_for_label }}">Ángulo Ano Rectal</label>
                        {{ form.oxford_anorectal_angle }}
                    </div>
                </div>
                
                <!-- Pujo -->
                <div class="checkbox-group">
                    <h4>Pujo</h4>
                    <div class="checkbox-row">
                        <div class="checkbox-item">{{ form.anorectal_opening }} <label for="{{ form.anorectal_opening.id_for_label }}">Apertura Ano Rectal</label></div>
                        <div class="checkbox-item">{{ form.thoracic_rectal_synchronization }} <label for="{{ form.thoracic_rectal_synchronization.id_for_label }}">Sincronización Toraco Rectal</label></div>
                        <div class="checkbox-item">{{ form.anal_canal_relaxation }} <label for="{{ form.anal_canal_relaxation.id_for_label }}">Relajación Canal Anal</label></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.coloproctologic_exam_other.id_for_label }}">Otros</label>
                    {{ form.coloproctologic_exam_other }}
                </div>
            </div>
        </div>
        <!-- For brevity, I'll add a collapsible section for the remaining fields -->
        
        <div class="form-actions">
            <button type="submit" class="btn btn-success btn-lg">
                {% if ficha %}Actualizar Ficha Clínica{% else %}Crear Ficha Clínica{% endif %}
            </button>
            <a href="{% url 'patient_detail' patient.pk %}" class="btn btn-secondary btn-lg">Cancelar</a>
        </div>
    </form>
</div>
<!-- BOTONES DE ACCIÓN FLOTANTES (fuera del contenedor) -->
<div class="floating-actions">
    <button type="submit" form="ficha-clinica-form" class="btn btn-primary btn-floating">
        {% if form.instance.pk %}Actualizar{% else %}Crear{% endif %}
    </button>
    <a href="{% url 'dashboard' %}" class="btn btn-secondary btn-floating">Cancelar</a>
</div>

{% endblock %}

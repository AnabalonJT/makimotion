{% extends 'base.html' %}

{% block title %}
    {% if form.instance.pk %}Editar Ficha Cl√≠nica{% else %}Nueva Ficha Cl√≠nica{% endif %} - MakiMotion
{% endblock %}

{% block content %}
<div class="clinical-form-container">
    <div class="form-header">
        <h2>
            {% if form.instance.pk %}
                Editar Ficha Cl√≠nica: {{ form.instance.full_name }}
            {% else %}
                Nueva Ficha Cl√≠nica - Piso P√©lvico
            {% endif %}
        </h2>
        <p class="form-subtitle">
            {% if form.instance.pk %}
                Actualiza la informaci√≥n de la ficha cl√≠nica
            {% else %}
                Completa los datos de la ficha cl√≠nica del paciente
            {% endif %}
        </p>
    </div>
    
    {% if form.errors %}
        <div class="alert alert-error">
            <strong>Por favor corrige los siguientes errores:</strong>
            <ul>
                {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>
        </div>
    {% endif %}
    
    <form method="post" class="clinical-form" id="patient-form">
        {% csrf_token %}

        
        
        <!-- SECCI√ìN 1: DATOS DEL PACIENTE -->
        <div class="form-section">
            <h3 class="section-title">üìã Datos del Paciente</h3>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.full_name.id_for_label }}">Nombre Completo *</label>
                        {{ form.full_name }}
                        {% if form.full_name.errors %}<span class="field-error">{{ form.full_name.errors.0 }}</span>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.age.id_for_label }}">Edad *</label>
                        {{ form.age }}
                        {% if form.age.errors %}<span class="field-error">{{ form.age.errors.0 }}</span>{% endif %}
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.profession.id_for_label }}">Profesi√≥n</label>
                        {{ form.profession }}
                        {% if form.profession.errors %}<span class="field-error">{{ form.profession.errors.0 }}</span>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.phone.id_for_label }}">Tel√©fono</label>
                        {{ form.phone }}
                        {% if form.phone.errors %}<span class="field-error">{{ form.phone.errors.0 }}</span>{% endif %}
                    </div>
                </div>
                <div class="form-group">
                    <label for="{{ form.address.id_for_label }}">Direcci√≥n</label>
                    {{ form.address }}
                    {% if form.address.errors %}<span class="field-error">{{ form.address.errors.0 }}</span>{% endif %}
                </div>
                <div class="form-group">
                    <label for="{{ form.consultation_reason.id_for_label }}">Motivo de Consulta</label>
                    {{ form.consultation_reason }}
                    {% if form.consultation_reason.errors %}<span class="field-error">{{ form.consultation_reason.errors.0 }}</span>{% endif %}
                </div>

                <!-- Embarazo -->
                <div class="subsection-group">
                    <h4>Embarazo</h4>
                    <div class="checkbox-item">
                        {{ form.is_pregnant }} <label for="{{ form.is_pregnant.id_for_label }}">¬øEst√° embarazada?</label>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.pregnancy_weeks_at_registration.id_for_label }}">Semanas de Embarazo Actuales</label>
                            {{ form.pregnancy_weeks_at_registration }}
                            {% if form.pregnancy_weeks_at_registration.errors %}<span class="field-error">{{ form.pregnancy_weeks_at_registration.errors.0 }}</span>{% endif %}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.pregnancy_week_day.id_for_label }}">D√≠a de la Semana para Contar</label>
                            {{ form.pregnancy_week_day }}
                            {% if form.pregnancy_week_day.errors %}<span class="field-error">{{ form.pregnancy_week_day.errors.0 }}</span>{% endif %}
                        </div>
                    </div>
                    <small class="text-muted">Las semanas se actualizar√°n autom√°ticamente cada {{ form.pregnancy_week_day.value|default:"d√≠a seleccionado" }}</small>
                </div>

        <script>
        // Mostrar/ocultar aprendizajes embarazo seg√∫n el checkbox
        document.addEventListener('DOMContentLoaded', function() {
            var embarazoCheckbox = document.getElementById('{{ form.is_pregnant.id_for_label }}');
            var embarazoSection = document.getElementById('aprendizajes-embarazo-section');
            function toggleEmbarazoSection() {
                if (embarazoCheckbox && embarazoCheckbox.checked) {
                    embarazoSection.style.display = '';
                } else {
                    embarazoSection.style.display = 'none';
                }
            }
            if (embarazoCheckbox && embarazoSection) {
                embarazoCheckbox.addEventListener('change', toggleEmbarazoSection);
                toggleEmbarazoSection();
            }
        });
        </script>
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.medications.id_for_label }}">Medicamentos</label>
                        {{ form.medications }}
                        {% if form.medications.errors %}<span class="field-error">{{ form.medications.errors.0 }}</span>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.musculoskeletal_history.id_for_label }}">Antecedentes M√∫sculo Esquel√©tico</label>
                        {{ form.musculoskeletal_history }}
                        {% if form.musculoskeletal_history.errors %}<span class="field-error">{{ form.musculoskeletal_history.errors.0 }}</span>{% endif %}
                    </div>
                </div>

                <div class="form-group">
                    <label for="{{ form.patient_data_other.id_for_label }}">Otros</label>
                    {{ form.patient_data_other }}
                </div>
            </div>
        </div>
        <!-- SECCI√ìN: APRENDIZAJES GENERALES -->
        <div class="form-section">
            <h3 class="section-title">üß† Aprendizajes Generales</h3>
            <div class="section-content">
                <div class="checkbox-group">
                    <div class="checkbox-row">
                        <div class="checkbox-item">{{ form.aprendizaje_pujo_caca }} <label for="{{ form.aprendizaje_pujo_caca.id_for_label }}">Pujo caca</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_banquito }} <label for="{{ form.aprendizaje_banquito.id_for_label }}">Uso de banquito</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_transverso }} <label for="{{ form.aprendizaje_transverso.id_for_label }}">Activaci√≥n transverso abdominal</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_respiracion_pelvico }} <label for="{{ form.aprendizaje_respiracion_pelvico.id_for_label }}">Respiraci√≥n + contracci√≥n piso p√©lvico</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_contraccion_pelvico }} <label for="{{ form.aprendizaje_contraccion_pelvico.id_for_label }}">Contracci√≥n piso p√©lvico</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_preapretar }} <label for="{{ form.aprendizaje_preapretar.id_for_label }}">Preapretar</label></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="{{ form.aprendizaje_otros.id_for_label }}">Otros aprendizajes generales</label>
                    {{ form.aprendizaje_otros }}
                </div>
            </div>
        </div>

        <!-- SECCI√ìN: APRENDIZAJES EMBARAZO (condicional) -->
        <div class="form-section" id="aprendizajes-embarazo-section" style="display:none;">
            <h3 class="section-title">ü§∞ Aprendizajes Embarazo</h3>
            <div class="section-content">
                <div class="checkbox-group">
                    <div class="checkbox-row">
                        <div class="checkbox-item">{{ form.aprendizaje_emb_oms }} <label for="{{ form.aprendizaje_emb_oms.id_for_label }}">OMS</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_emb_anatomia }} <label for="{{ form.aprendizaje_emb_anatomia.id_for_label }}">Anatom√≠a</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_emb_movimientos }} <label for="{{ form.aprendizaje_emb_movimientos.id_for_label }}">Movimientos cardinales</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_emb_posicion_trabajo }} <label for="{{ form.aprendizaje_emb_posicion_trabajo.id_for_label }}">Posici√≥n trabajo de parto</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_emb_posicion_expulsion }} <label for="{{ form.aprendizaje_emb_posicion_expulsion.id_for_label }}">Posici√≥n expulsi√≥n</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_emb_intervencion }} <label for="{{ form.aprendizaje_emb_intervencion.id_for_label }}">Intervenci√≥n obst√©trica</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_emb_masaje_perineal }} <label for="{{ form.aprendizaje_emb_masaje_perineal.id_for_label }}">Masaje perineal</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_emb_respiraciones }} <label for="{{ form.aprendizaje_emb_respiraciones.id_for_label }}">Respiraciones</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_emb_pujo }} <label for="{{ form.aprendizaje_emb_pujo.id_for_label }}">Pujo embarazo</label></div>
                        <div class="checkbox-item">{{ form.aprendizaje_emb_tecnicas_dolor }} <label for="{{ form.aprendizaje_emb_tecnicas_dolor.id_for_label }}">T√©cnicas de dolor</label></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="{{ form.aprendizaje_emb_otros.id_for_label }}">Otros aprendizajes embarazo</label>
                    {{ form.aprendizaje_emb_otros }}
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 2: ANTECEDENTES GINECOL√ìGICOS -->
        <div class="form-section">
            <h3 class="section-title">ü©∫ Antecedentes Ginecol√≥gicos</h3>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.menopause.id_for_label }}">Menopausia</label>
                        {{ form.menopause }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.menopause_time.id_for_label }}">Hace Cu√°nto</label>
                        {{ form.menopause_time }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.regular_menstrual_cycle.id_for_label }}">Ciclo Menstrual Regular</label>
                        {{ form.regular_menstrual_cycle }}
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.pregnancies_g.id_for_label }}">G (Gestaciones)</label>
                        {{ form.pregnancies_g }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.abortions_a.id_for_label }}">A (Abortos)</label>
                        {{ form.abortions_a }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.losses_p.id_for_label }}">P (P√©rdidas)</label>
                        {{ form.losses_p }}
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.child_weight.id_for_label }}">Peso del Hijo</label>
                        {{ form.child_weight }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.delivery_type.id_for_label }}">Tipo de Parto</label>
                        {{ form.delivery_type }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.episiotomies.id_for_label }}">Episiotom√≠as</label>
                        {{ form.episiotomies }}
                    </div>
                </div>
                
                <!-- Checkboxes ginecol√≥gicos -->
                <div class="checkbox-group">
                    <h4>Indicadores</h4>
                    <div class="checkbox-row">
                        <div class="checkbox-item">
                            {{ form.io }} <label for="{{ form.io.id_for_label }}">IO</label>
                        </div>
                        <div class="checkbox-item">
                            {{ form.if_field }} <label for="{{ form.if_field.id_for_label }}">IF</label>
                        </div>
                        <div class="checkbox-item">
                            {{ form.ig }} <label for="{{ form.ig.id_for_label }}">IG</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.prolapse.id_for_label }}">Prolapso</label>
                        {{ form.prolapse }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.prolapse_type.id_for_label }}">¬øCu√°l Prolapso?</label>
                        {{ form.prolapse_type }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.allergies.id_for_label }}">Alergias</label>
                    {{ form.allergies }}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.gynecological_other.id_for_label }}">Otros</label>
                    {{ form.gynecological_other }}
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 3: H√ÅBITOS DE VIDA -->
        <div class="form-section">
            <h3 class="section-title">üèÉ‚Äç‚ôÄÔ∏è H√°bitos de Vida</h3>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.smoking.id_for_label }}">Fuma</label>
                        {{ form.smoking }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.alcohol.id_for_label }}">Alcohol</label>
                        {{ form.alcohol }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.daily_liquid_consumption.id_for_label }}">Consumo L√≠quido Diario</label>
                        {{ form.daily_liquid_consumption }}
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.physical_activity.id_for_label }}">Actividad F√≠sica</label>
                        {{ form.physical_activity }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.diet.id_for_label }}">Dieta</label>
                        {{ form.diet }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.lifestyle_other.id_for_label }}">Otros</label>
                    {{ form.lifestyle_other }}
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 4: FUNCI√ìN URINARIA -->
        <div class="form-section">
            <h3 class="section-title">üíß Funci√≥n Urinaria</h3>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.daily_frequency.id_for_label }}">Frecuencia Diaria</label>
                        {{ form.daily_frequency }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.nocturnal_frequency.id_for_label }}">Frecuencia Nocturna</label>
                        {{ form.nocturnal_frequency }}
                    </div>
                </div>
                
                <!-- Checkboxes funci√≥n urinaria -->
                <div class="checkbox-group">
                    <h4>S√≠ntomas Urinarios</h4>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">{{ form.pollakiuria }} <label for="{{ form.pollakiuria.id_for_label }}">Polaquiuria</label></div>
                        <div class="checkbox-item">{{ form.nocturia }} <label for="{{ form.nocturia.id_for_label }}">Nocturia</label></div>
                        <div class="checkbox-item">{{ form.urgency }} <label for="{{ form.urgency.id_for_label }}">Urgencia</label></div>
                        <div class="checkbox-item">{{ form.polyuria }} <label for="{{ form.polyuria.id_for_label }}">Poliuria</label></div>
                        <div class="checkbox-item">{{ form.dysuria }} <label for="{{ form.dysuria.id_for_label }}">Disuria</label></div>
                        <div class="checkbox-item">{{ form.latency }} <label for="{{ form.latency.id_for_label }}">Latencia</label></div>
                        <div class="checkbox-item">{{ form.effort_to_urinate }} <label for="{{ form.effort_to_urinate.id_for_label }}">Esfuerzo para Orinar</label></div>
                        <div class="checkbox-item">{{ form.incomplete_emptying }} <label for="{{ form.incomplete_emptying.id_for_label }}">Vaciamiento Incompleto</label></div>
                        <div class="checkbox-item">{{ form.immediate_need }} <label for="{{ form.immediate_need.id_for_label }}">Necesidad Inmediata</label></div>
                        <div class="checkbox-item">{{ form.terminal_dripping }} <label for="{{ form.terminal_dripping.id_for_label }}">Goteo Terminal</label></div>
                        <div class="checkbox-item">{{ form.nocturnal_urgency }} <label for="{{ form.nocturnal_urgency.id_for_label }}">Urgencia Nocturna</label></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.urination_position.id_for_label }}">Posici√≥n Adoptada para Micci√≥n</label>
                        {{ form.urination_position }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.stream_description.id_for_label }}">Descripci√≥n del Chorro</label>
                        {{ form.stream_description }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.urinary_function_other.id_for_label }}">Otros</label>
                    {{ form.urinary_function_other }}
                </div>
            </div>
        </div>

        <!-- SUBSECCI√ìN: INCONTINENCIA ORINA -->
        <div class="form-section subsection">
            <h3 class="section-title">üí¶ Incontinencia Orina</h3>
            <div class="section-content">
                <!-- Checkboxes incontinencia -->
                <div class="checkbox-group">
                    <h4>Tipos de Incontinencia</h4>
                    <div class="checkbox-row">
                        <div class="checkbox-item">{{ form.iue }} <label for="{{ form.iue.id_for_label }}">IUE</label></div>
                        <div class="checkbox-item">{{ form.iuu }} <label for="{{ form.iuu.id_for_label }}">IUU</label></div>
                        <div class="checkbox-item">{{ form.ium }} <label for="{{ form.ium.id_for_label }}">IUM</label></div>
                        <div class="checkbox-item">{{ form.iu_posture }} <label for="{{ form.iu_posture.id_for_label }}">IU Postura</label></div>
                        <div class="checkbox-item">{{ form.iu_sensitivity }} <label for="{{ form.iu_sensitivity.id_for_label }}">IU Sensibilidad</label></div>
                        <div class="checkbox-item">{{ form.iu_coital }} <label for="{{ form.iu_coital.id_for_label }}">IU Coital</label></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.incontinence_other.id_for_label }}">Otros</label>
                        {{ form.incontinence_other }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.since_when.id_for_label }}">Hace Cu√°nto</label>
                        {{ form.since_when }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.when_occurs_daily.id_for_label }}">Cu√°ndo Ocurre por D√≠a</label>
                        {{ form.when_occurs_daily }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.how_daily.id_for_label }}">C√≥mo es por D√≠a</label>
                        {{ form.how_daily }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.protection_type.id_for_label }}">Tipo de Protecci√≥n</label>
                        {{ form.protection_type }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.activities_stopped.id_for_label }}">Actividades Dejadas</label>
                        {{ form.activities_stopped }}
                    </div>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 5: FUNCIONAMIENTO INTESTINAL -->
        <div class="form-section">
            <h3 class="section-title">ü¶¥ Funcionamiento Intestinal</h3>
            <div class="section-content">
                <!-- Checkboxes intestinales -->
                <div class="checkbox-group">
                    <h4>S√≠ntomas Intestinales</h4>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">{{ form.constipation }} <label for="{{ form.constipation.id_for_label }}">Estre√±imiento</label></div>
                        <div class="checkbox-item">{{ form.fecal_incontinence }} <label for="{{ form.fecal_incontinence.id_for_label }}">Incontinencia</label></div>
                        <div class="checkbox-item">{{ form.gas_incontinence }} <label for="{{ form.gas_incontinence.id_for_label }}">Incontinencia Gases</label></div>
                        <div class="checkbox-item">{{ form.hemorrhoids }} <label for="{{ form.hemorrhoids.id_for_label }}">Hemorroides</label></div>
                        <div class="checkbox-item">{{ form.rectocele }} <label for="{{ form.rectocele.id_for_label }}">Rectocele</label></div>
                        <div class="checkbox-item">{{ form.gas_stool_discrimination }} <label for="{{ form.gas_stool_discrimination.id_for_label }}">Discriminaci√≥n Gas/Caca</label></div>
                        <div class="checkbox-item">{{ form.painful_evacuation }} <label for="{{ form.painful_evacuation.id_for_label }}">Evacuaci√≥n Dolorosa</label></div>
                        <div class="checkbox-item">{{ form.straining_defecation }} <label for="{{ form.straining_defecation.id_for_label }}">Puja para Defecar</label></div>
                        <div class="checkbox-item">{{ form.complete_evacuation }} <label for="{{ form.complete_evacuation.id_for_label }}">Evacuaci√≥n Completa</label></div>
                        <div class="checkbox-item">{{ form.laxatives }} <label for="{{ form.laxatives.id_for_label }}">Laxantes</label></div>
                        <div class="checkbox-item">{{ form.plugging_sensation }} <label for="{{ form.plugging_sensation.id_for_label }}">Sensaci√≥n de Tap√≥n</label></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.defecation_position.id_for_label }}">Posici√≥n para Defecar</label>
                        {{ form.defecation_position }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.bristol_scale.id_for_label }}">Escala Bristol (1-7)</label>
                        {{ form.bristol_scale }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.position_frequency.id_for_label }}">Frecuencia de Posiciones</label>
                    {{ form.position_frequency }}
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.bowel_inconsistency.id_for_label }}">¬øSufre Inconsistencia? ¬øCu√°ndo?</label>
                        {{ form.bowel_inconsistency }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.bowel_conscious.id_for_label }}">¬øEs Consciente?</label>
                        {{ form.bowel_conscious }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.bowel_pad.id_for_label }}">¬øAp√≥sito?</label>
                        {{ form.bowel_pad }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.bowel_activities_stopped.id_for_label }}">Actividades Dejadas</label>
                        {{ form.bowel_activities_stopped }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.bowel_function_other.id_for_label }}">Otros</label>
                    {{ form.bowel_function_other }}
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 6: HISTORIAL SEXUAL -->
        <div class="form-section">
            <h3 class="section-title">üíï Historial Sexual</h3>
            <div class="section-content">
                <div class="form-group">
                    <label for="{{ form.sexual_status.id_for_label }}">Estado Sexual</label>
                    {{ form.sexual_status }}
                </div>
                
                <div class="checkbox-group">
                    <h4>Incontinencia Durante Actividad Sexual</h4>
                    <div class="checkbox-row">
                        <div class="checkbox-item">
                            {{ form.urinary_incontinence_sexual }} <label for="{{ form.urinary_incontinence_sexual.id_for_label }}">Incontinencia Orina</label>
                        </div>
                        <div class="checkbox-item">
                            {{ form.fecal_incontinence_sexual }} <label for="{{ form.fecal_incontinence_sexual.id_for_label }}">Incontinencia Fecal</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.urinary_incontinence_sexual_when.id_for_label }}">Incontinencia Orina - ¬øCu√°ndo?</label>
                        {{ form.urinary_incontinence_sexual_when }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.fecal_incontinence_sexual_when.id_for_label }}">Incontinencia Fecal - ¬øCu√°ndo?</label>
                        {{ form.fecal_incontinence_sexual_when }}
                    </div>
                </div>
                
                <div class="checkbox-group">
                    <h4>S√≠ntomas Sexuales</h4>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">{{ form.sexual_desire }} <label for="{{ form.sexual_desire.id_for_label }}">Deseo Sexual</label></div>
                        <div class="checkbox-item">{{ form.sexual_excitement }} <label for="{{ form.sexual_excitement.id_for_label }}">Excitaci√≥n</label></div>
                        <div class="checkbox-item">{{ form.orgasm }} <label for="{{ form.orgasm.id_for_label }}">Orgasmo</label></div>
                        <div class="checkbox-item">{{ form.dyspareunia }} <label for="{{ form.dyspareunia.id_for_label }}">Dispareunia</label></div>
                        <div class="checkbox-item">{{ form.urge_to_urinate_during_sex }} <label for="{{ form.urge_to_urinate_during_sex.id_for_label }}">Deseo de Orinar Durante</label></div>
                        <div class="checkbox-item">{{ form.vaginal_dryness }} <label for="{{ form.vaginal_dryness.id_for_label }}">Resequedad</label></div>
                        <div class="checkbox-item">{{ form.impaired_by_incontinence }} <label for="{{ form.impaired_by_incontinence.id_for_label }}">Perjudicado por Incontinencia</label></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.sexual_history_other.id_for_label }}">Otros</label>
                    {{ form.sexual_history_other }}
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 7: EXAMEN F√çSICO -->
        <div class="form-section">
            <h3 class="section-title">üîç Examen F√≠sico</h3>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.diastasis.id_for_label }}">Diastasis</label>
                        {{ form.diastasis }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.scars.id_for_label }}">Cicatrices</label>
                        {{ form.scars }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.adherences.id_for_label }}">Adherencias</label>
                        {{ form.adherences }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.skin_coloration.id_for_label }}">Coloraci√≥n de la Piel</label>
                        {{ form.skin_coloration }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.push_exam.id_for_label }}">Pujo</label>
                    {{ form.push_exam }}
                </div>
                
                <!-- NCP - Tono -->
                <div class="subsection-group">
                    <h4>NCP - Tono</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.ncp_tone_contraction.id_for_label }}">Contracci√≥n</label>
                            {{ form.ncp_tone_contraction }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.ncp_tone_relaxation.id_for_label }}">Relajaci√≥n</label>
                            {{ form.ncp_tone_relaxation }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.ncp_tone_push.id_for_label }}">Pujo</label>
                            {{ form.ncp_tone_push }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.ncp_tone_pain.id_for_label }}">Dolor</label>
                            {{ form.ncp_tone_pain }}
                        </div>
                    </div>
                </div>
                
                <!-- Sensibilidad y reflejo -->
                <div class="subsection-group">
                    <h4>Sensibilidad y Reflejo (Dermatoma S2-S4)</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.anal_cutaneous_reflex.id_for_label }}">Reflejo Cut√°neo Anal</label>
                            {{ form.anal_cutaneous_reflex }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.vulvo_cavernous_reflex.id_for_label }}">Reflejo Vulvo Cavernoso</label>
                            {{ form.vulvo_cavernous_reflex }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.cough_reflex.id_for_label }}">Reflejo Tus√≠geno</label>
                            {{ form.cough_reflex }}
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.physical_exam_other.id_for_label }}">Otros</label>
                    {{ form.physical_exam_other }}
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 8: EXAMEN INTRACAVITARIO -->
        <div class="form-section">
            <h3 class="section-title">üî¨ Examen Intracavitario</h3>
            <div class="section-content">
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        {{ form.intracavitary_consent }} <label for="{{ form.intracavitary_consent.id_for_label }}">Consentimiento</label>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.intracavitary_scars.id_for_label }}">Cicatrices</label>
                        {{ form.intracavitary_scars }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.intracavitary_mucosa.id_for_label }}">Mucosa</label>
                        {{ form.intracavitary_mucosa }}
                    </div>
                </div>
                
                <!-- MEA -->
                <div class="subsection-group">
                    <h4>MEA (M√∫sculos del Elevador del Ano)</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.mea_tonicity_rest.id_for_label }}">Tonicidad MEA Reposo</label>
                            {{ form.mea_tonicity_rest }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.mea_perception.id_for_label }}">Percepci√≥n MEA</label>
                            {{ form.mea_perception }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.mea_contraction.id_for_label }}">Contracci√≥n MEA</label>
                            {{ form.mea_contraction }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.mea_voluntary_relaxation.id_for_label }}">Relajaci√≥n Voluntaria MEA</label>
                            {{ form.mea_voluntary_relaxation }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.mea_symmetry_rest.id_for_label }}">Simetr√≠a MEA Reposo</label>
                            {{ form.mea_symmetry_rest }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.mea_symmetry_contraction.id_for_label }}">Simetr√≠a MEA Contracci√≥n</label>
                            {{ form.mea_symmetry_contraction }}
                        </div>
                    </div>
                </div>
                
                <!-- Dolor MEA -->
                <div class="subsection-group">
                    <h4>Dolor MEA</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.mea_pain_eva.id_for_label }}">EVA (0-10)</label>
                            {{ form.mea_pain_eva }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.mea_pain_location.id_for_label }}">D√≥nde</label>
                            {{ form.mea_pain_location }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.mea_pain_when.id_for_label }}">Cu√°ndo</label>
                            {{ form.mea_pain_when }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.mea_pain_description.id_for_label }}">Descripci√≥n</label>
                            {{ form.mea_pain_description }}
                        </div>
                    </div>
                </div>
                
                <!-- Otros ex√°menes -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.urethral_movement.id_for_label }}">Movimiento Uretral</label>
                        {{ form.urethral_movement }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.transverse_abdominal_tone.id_for_label }}">Tono del Transverso Abdominal</label>
                        {{ form.transverse_abdominal_tone }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.oxford_force.id_for_label }}">Fuerza (Oxford)</label>
                        {{ form.oxford_force }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.superficial_musculature.id_for_label }}">Musculatura Superficial</label>
                        {{ form.superficial_musculature }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.deep_musculature.id_for_label }}">Musculatura Profunda</label>
                    {{ form.deep_musculature }}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.intracavitary_exam_other.id_for_label }}">Otros</label>
                    {{ form.intracavitary_exam_other }}
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 9: EXAMEN COLOPROCTOL√ìGICO -->
        <div class="form-section">
            <h3 class="section-title">ü©ª Examen Coloproctol√≥gico</h3>
            <div class="section-content">
                <div class="checkbox-group">
                    <h4>Consentimiento y Observaciones</h4>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">{{ form.coloproctologic_consent }} <label for="{{ form.coloproctologic_consent.id_for_label }}">Consentimiento</label></div>
                        <div class="checkbox-item">{{ form.anal_canal_closure }} <label for="{{ form.anal_canal_closure.id_for_label }}">Cierre Canal Anal</label></div>
                        <div class="checkbox-item">{{ form.irritation }} <label for="{{ form.irritation.id_for_label }}">Irritaci√≥n</label></div>
                        <div class="checkbox-item">{{ form.stool_remains }} <label for="{{ form.stool_remains.id_for_label }}">Resto de Deposiciones</label></div>
                        <div class="checkbox-item">{{ form.rectocele_exam }} <label for="{{ form.rectocele_exam.id_for_label }}">Recto Cele</label></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.coloproctologic_scars.id_for_label }}">Cicatriz - ¬øD√≥nde?</label>
                        {{ form.coloproctologic_scars }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.coloproctologic_hemorrhoids.id_for_label }}">Hemorroides - ¬øD√≥nde?</label>
                        {{ form.coloproctologic_hemorrhoids }}
                    </div>
                </div>
                
                <!-- Tono y resistencia -->
                <div class="subsection-group">
                    <h4>Tono y Resistencia</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.rest_tone.id_for_label }}">Tono en Reposo</label>
                            {{ form.rest_tone }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.resistance.id_for_label }}">Resistencia</label>
                            {{ form.resistance }}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.eae_tonicity_rest.id_for_label }}">Tonicidad EAE Reposo</label>
                            {{ form.eae_tonicity_rest }}
                        </div>
                        <div class="form-group">
                            <label for="{{ form.eae_contraction.id_for_label }}">Contracci√≥n EAE</label>
                            {{ form.eae_contraction }}
                        </div>
                    </div>
                </div>
                
                <!-- Oxford -->
                <div class="subsection-group">
                    <h4>Oxford</h4>
                    <div class="form-group">
                        <label for="{{ form.oxford_notes.id_for_label }}">Oxford</label>
                        {{ form.oxford_notes }}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.oxford_anorectal_angle.id_for_label }}">√Ångulo Ano Rectal</label>
                        {{ form.oxford_anorectal_angle }}
                    </div>
                </div>
                
                <!-- Pujo -->
                <div class="checkbox-group">
                    <h4>Pujo</h4>
                    <div class="checkbox-row">
                        <div class="checkbox-item">{{ form.anorectal_opening }} <label for="{{ form.anorectal_opening.id_for_label }}">Apertura Ano Rectal</label></div>
                        <div class="checkbox-item">{{ form.thoracic_rectal_synchronization }} <label for="{{ form.thoracic_rectal_synchronization.id_for_label }}">Sincronizaci√≥n Toraco Rectal</label></div>
                        <div class="checkbox-item">{{ form.anal_canal_relaxation }} <label for="{{ form.anal_canal_relaxation.id_for_label }}">Relajaci√≥n Canal Anal</label></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="{{ form.coloproctologic_exam_other.id_for_label }}">Otros</label>
                    {{ form.coloproctologic_exam_other }}
                </div>
            </div>
        </div>

        <!-- BOTONES DE ACCI√ìN NORMALES (para m√≥viles) -->
        <!-- SECCI√ìN: ESTADO (alta) -->
        <div class="form-section">
            <h3 class="section-title">Estado</h3>
            <div class="section-content">
                <div class="form-group">
                    <div class="checkbox-item">
                        {{ form.alta }} <label for="{{ form.alta.id_for_label }}">Paciente dado de alta</label>
                        {% if form.alta.errors %}<span class="field-error">{{ form.alta.errors.0 }}</span>{% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                {% if form.instance.pk %}Actualizar Ficha Cl√≠nica{% else %}Crear Ficha Cl√≠nica{% endif %}
            </button>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

<!-- BOTONES DE ACCI√ìN FLOTANTES (fuera del contenedor) -->
<div class="floating-actions">
    <button type="submit" form="patient-form" class="btn btn-primary btn-floating">
        {% if form.instance.pk %}Actualizar{% else %}Crear{% endif %}
    </button>
    <a href="{% url 'dashboard' %}" class="btn btn-secondary btn-floating">Cancelar</a>
</div>

{% endblock %}